<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SuiLight çŸ¥è¯†æ²™é¾™</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .datm-radar { max-width: 400px; margin: 0 auto; }
        .agent-card { transition: all 0.2s; }
        .agent-card:hover { transform: translateY(-2px); box-shadow: 0 4px 12px rgba(0,0,0,0.15); }
        .loading { animation: pulse 1.5s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
    </style>
</head>
<body class="bg-gray-50 min-h-screen">
    <!-- å¯¼èˆªæ  -->
    <nav class="bg-indigo-600 text-white shadow-lg">
        <div class="max-w-7xl mx-auto px-4 py-4 flex justify-between items-center">
            <div class="flex items-center gap-3">
                <span class="text-2xl">ğŸ§ </span>
                <h1 class="text-xl font-bold">SuiLight çŸ¥è¯†æ²™é¾™</h1>
            </div>
            <div class="flex gap-4 text-sm">
                <button onclick="showTab('agents')" class="hover:text-indigo-200">ğŸ¤– æ€æƒ³å®¶</button>
                <button onclick="showTab('discussions')" class="hover:text-indigo-200">ğŸ’¬ è®¨è®º</button>
                <button onclick="showTab('tasks')" class="hover:text-indigo-200">âš¡ ä»»åŠ¡</button>
                <button onclick="showTab('create')" class="hover:text-indigo-200">â• åˆ›å»º</button>
            </div>
        </div>
    </nav>

    <!-- ä¸»å†…å®¹åŒº -->
    <main class="max-w-7xl mx-auto px-4 py-8">
        
        <!-- çŠ¶æ€æ  -->
        <div id="status-bar" class="bg-white rounded-lg shadow p-4 mb-6 flex justify-between items-center">
            <div class="flex gap-6 text-sm">
                <span>ğŸ¤– Agent: <strong id="agent-count">0</strong></span>
                <span>ğŸ’¬ è®¨è®º: <strong id="discussion-count">0</strong></span>
                <span>âš¡ ä»»åŠ¡: <strong id="task-count">0</strong></span>
            </div>
            <div class="flex gap-2">
                <button onclick="createAllAgents()" class="bg-indigo-500 hover:bg-indigo-600 text-white px-4 py-2 rounded text-sm">
                    ğŸš€ æ‰¹é‡åˆ›å»º 100 ä½æ€æƒ³å®¶
                </button>
                <button onclick="refreshAll()" class="bg-gray-500 hover:bg-gray-600 text-white px-4 py-2 rounded text-sm">
                    ğŸ”„ åˆ·æ–°
                </button>
            </div>
        </div>

        <!-- Tab: æ€æƒ³å®¶åˆ—è¡¨ -->
        <div id="tab-agents" class="tab-content">
            <div class="flex gap-4 mb-4">
                <input type="text" id="search-agent" placeholder="æœç´¢æ€æƒ³å®¶..." 
                    class="flex-1 border rounded-lg px-4 py-2" onkeyup="searchAgents()">
                <select id="filter-domain" class="border rounded-lg px-4 py-2" onchange="filterAgents()">
                    <option value="">å…¨éƒ¨é¢†åŸŸ</option>
                    <option value="physics">ç‰©ç†å­¦</option>
                    <option value="biology">ç”Ÿç‰©å­¦</option>
                    <option value="chemistry">åŒ–å­¦</option>
                    <option value="mathematics">æ•°å­¦</option>
                    <option value="economics">ç»æµå­¦</option>
                    <option value="psychology">å¿ƒç†å­¦</option>
                    <option value="philosophy">å“²å­¦</option>
                    <option value="interdisciplinary">äº¤å‰ç§‘å­¦</option>
                </select>
            </div>
            <div id="agents-grid" class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
                <!-- Agent å¡ç‰‡ä¼šåŠ¨æ€æ’å…¥ -->
            </div>
        </div>

        <!-- Tab: è®¨è®ºåˆ—è¡¨ -->
        <div id="tab-discussions" class="tab-content hidden">
            <div class="flex gap-4 mb-4">
                <button onclick="createDiscussion()" class="bg-green-500 hover:bg-green-600 text-white px-4 py-2 rounded">
                    â• åˆ›å»ºè®¨è®º
                </button>
                <button onclick="loadGreatDiscussions()" class="bg-blue-500 hover:bg-blue-600 text-white px-4 py-2 rounded">
                    ğŸ“– åŠ è½½ä¼Ÿå¤§è®¨è®º
                </button>
            </div>
            <div id="discussions-list" class="space-y-4">
                <!-- è®¨è®ºä¼šåŠ¨æ€æ’å…¥ -->
            </div>
        </div>

        <!-- Tab: ä»»åŠ¡é˜Ÿåˆ— -->
        <div id="tab-tasks" class="tab-content hidden">
            <div class="bg-white rounded-lg shadow p-4">
                <h2 class="text-lg font-bold mb-4">âš¡ å¼‚æ­¥ä»»åŠ¡é˜Ÿåˆ—</h2>
                <div id="tasks-list" class="space-y-3">
                    <!-- ä»»åŠ¡ä¼šåŠ¨æ€æ’å…¥ -->
                </div>
            </div>
        </div>

        <!-- Tab: åˆ›å»ºæ–°å†…å®¹ -->
        <div id="tab-create" class="tab-content hidden">
            <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
                <!-- åˆ›å»º Agent -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-lg font-bold mb-4">ğŸ¤– åˆ›å»º Agent</h2>
                    <div class="space-y-3">
                        <input type="text" id="new-agent-name" placeholder="åç§°" class="w-full border rounded px-3 py-2">
                        <input type="text" id="new-agent-domain" placeholder="é¢†åŸŸ" class="w-full border rounded px-3 py-2">
                        <textarea id="new-agent-desc" placeholder="æè¿°" class="w-full border rounded px-3 py-2 h-24"></textarea>
                        <button onclick="createNewAgent()" class="w-full bg-indigo-500 hover:bg-indigo-600 text-white py-2 rounded">
                            åˆ›å»º
                        </button>
                    </div>
                </div>

                <!-- åˆ›å»ºè®¨è®º -->
                <div class="bg-white rounded-lg shadow p-6">
                    <h2 class="text-lg font-bold mb-4">ğŸ’¬ åˆ›å»ºè®¨è®º</h2>
                    <div class="space-y-3">
                        <input type="text" id="new-discussion-title" placeholder="è®¨è®ºæ ‡é¢˜" class="w-full border rounded px-3 py-2">
                        <textarea id="new-discussion-desc" placeholder="æè¿°" class="w-full border rounded px-3 py-2 h-24"></textarea>
                        <select id="new-discussion-category" class="w-full border rounded px-3 py-2">
                            <option value="äº¤å‰ç§‘å­¦">äº¤å‰ç§‘å­¦</option>
                            <option value="è‡ªç„¶ç§‘å­¦">è‡ªç„¶ç§‘å­¦</option>
                            <option value="ç¤¾ä¼šç§‘å­¦">ç¤¾ä¼šç§‘å­¦</option>
                            <option value="äººæ–‡ç§‘å­¦">äººæ–‡ç§‘å­¦</option>
                        </select>
                        <button onclick="createNewDiscussion()" class="w-full bg-green-500 hover:bg-green-600 text-white py-2 rounded">
                            åˆ›å»ºè®¨è®º
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ¨¡æ€æ¡†: Agent è¯¦æƒ… -->
        <div id="modal-agent" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center">
            <div class="bg-white rounded-lg max-w-2xl w-full mx-4 max-h-90vh overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-start mb-4">
                        <h2 id="modal-agent-name" class="text-xl font-bold"></h2>
                        <button onclick="closeModal('modal-agent')" class="text-gray-500 hover:text-gray-700">âœ•</button>
                    </div>
                    <p id="modal-agent-desc" class="text-gray-600 mb-4"></p>
                    <div class="mb-4">
                        <h3 class="font-bold mb-2">ğŸ§  DATM çŸ¥è¯†çŸ©é˜µ</h3>
                        <canvas id="datm-radar" class="datm-radar"></canvas>
                    </div>
                    <div class="border-t pt-4">
                        <h3 class="font-bold mb-2">ğŸ’¬ å¯¹è¯</h3>
                        <div id="chat-history" class="bg-gray-100 rounded p-3 h-48 overflow-y-auto mb-2 text-sm"></div>
                        <div class="flex gap-2">
                            <input type="text" id="chat-input" placeholder="è¾“å…¥æ¶ˆæ¯..." class="flex-1 border rounded px-3 py-2" onkeypress="if(event.key==='Enter')sendChat()">
                            <button onclick="sendChat()" class="bg-indigo-500 text-white px-4 py-2 rounded">å‘é€</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- æ¨¡æ€æ¡†: è®¨è®ºè¯¦æƒ… -->
        <div id="modal-discussion" class="fixed inset-0 bg-black bg-opacity-50 hidden flex items-center justify-center">
            <div class="bg-white rounded-lg max-w-3xl w-full mx-4 max-h-90vh overflow-y-auto">
                <div class="p-6">
                    <div class="flex justify-between items-start mb-4">
                        <div>
                            <h2 id="modal-discussion-title" class="text-xl font-bold"></h2>
                            <p id="modal-discussion-desc" class="text-gray-600"></p>
                        </div>
                        <button onclick="closeModal('modal-discussion')" class="text-gray-500 hover:text-gray-700">âœ•</button>
                    </div>
                    
                    <div class="mb-4 flex gap-2">
                        <span id="modal-discussion-phase" class="bg-blue-100 text-blue-800 px-3 py-1 rounded-full text-sm"></span>
                        <span id="modal-discussion-participants" class="bg-green-100 text-green-800 px-3 py-1 rounded-full text-sm"></span>
                    </div>

                    <!-- å‚ä¸è€… -->
                    <div class="mb-4">
                        <h3 class="font-bold mb-2">ğŸ‘¥ å‚ä¸è€…</h3>
                        <div id="modal-discussion-agents" class="flex flex-wrap gap-2"></div>
                    </div>

                    <!-- è´¡çŒ®åˆ—è¡¨ -->
                    <div class="border-t pt-4 mb-4">
                        <h3 class="font-bold mb-2">ğŸ’­ è®¨è®ºå†…å®¹</h3>
                        <div id="modal-discussion-contributions" class="space-y-2 max-h-64 overflow-y-auto"></div>
                    </div>

                    <!-- æ“ä½œæŒ‰é’® -->
                    <div class="flex gap-2">
                        <button onclick="startDiscussionFromModal()" class="bg-green-500 text-white px-4 py-2 rounded">â–¶ï¸ å¼€å§‹è®¨è®º</button>
                        <button onclick="addContribution()" class="bg-blue-500 text-white px-4 py-2 rounded">ğŸ’¬ æ·»åŠ è§‚ç‚¹</button>
                        <button onclick="extractInsightsFromModal()" class="bg-purple-500 text-white px-4 py-2 rounded">ğŸ“š æå–æ´è§</button>
                    </div>

                    <!-- æ´è§ -->
                    <div id="modal-insights" class="border-t pt-4 mt-4 hidden">
                        <h3 class="font-bold mb-2">ğŸ’¡ æ´è§</h3>
                        <div id="modal-insights-list" class="space-y-2"></div>
                    </div>
                </div>
            </div>
        </div>

    </main>

    <script>
        const API_BASE = 'http://localhost:8000';
        let currentAgentId = null;
        let currentDiscussionId = null;
        let datmChart = null;

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            refreshAll();
        });

        // Tab åˆ‡æ¢
        function showTab(tabName) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.add('hidden'));
            document.getElementById(`tab-${tabName}`).classList.remove('hidden');
        }

        // åˆ·æ–°æ‰€æœ‰æ•°æ®
        async function refreshAll() {
            await Promise.all([
                loadAgents(),
                loadDiscussions(),
                loadTasks()
            ]);
        }

        // ============ Agent ç›¸å…³ ============

        async function loadAgents() {
            try {
                const resp = await fetch(`${API_BASE}/api/agents`);
                const data = await resp.json();
                const agents = data.data.agents || {};
                const agentList = Object.values(agents);
                
                document.getElementById('agent-count').textContent = agentList.length;
                renderAgents(agentList);
            } catch (e) {
                console.error('åŠ è½½ Agent å¤±è´¥:', e);
            }
        }

        function renderAgents(agents) {
            const grid = document.getElementById('agents-grid');
            grid.innerHTML = agents.map(agent => `
                <div class="agent-card bg-white rounded-lg shadow p-4 cursor-pointer" onclick="showAgentDetail('${agent.id}')">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-bold">${agent.name}</h3>
                            <span class="text-xs bg-gray-100 px-2 py-1 rounded">${agent.domain}</span>
                        </div>
                        <span class="text-2xl">${getDomainEmoji(agent.domain)}</span>
                    </div>
                    <p class="text-sm text-gray-600 mt-2 line-clamp-2">${agent.description || ''}</p>
                    <div class="mt-3 flex gap-2 text-xs">
                        <span class="bg-blue-100 px-2 py-1 rounded">çœŸ: ${agent.datm?.truth || 50}</span>
                        <span class="bg-green-100 px-2 py-1 rounded">å–„: ${agent.datm?.goodness || 50}</span>
                        <span class="bg-pink-100 px-2 py-1 rounded">ç¾: ${agent.datm?.beauty || 50}</span>
                        <span class="bg-purple-100 px-2 py-1 rounded">çµ: ${agent.datm?.intelligence || 50}</span>
                    </div>
                </div>
            `).join('');
        }

        async function showAgentDetail(agentId) {
            try {
                const resp = await fetch(`${API_BASE}/api/agents/${agentId}`);
                const data = await resp.json();
                const agent = data.data;

                currentAgentId = agentId;
                document.getElementById('modal-agent-name').textContent = agent.name;
                document.getElementById('modal-agent-desc').textContent = agent.description || '';
                document.getElementById('chat-history').innerHTML = '<div class="text-gray-500">å¼€å§‹å¯¹è¯...</div>';
                document.getElementById('modal-agent').classList.remove('hidden');

                // ç»˜åˆ¶ DATM
                renderDATM(agent.datm);
            } catch (e) {
                console.error('è·å– Agent è¯¦æƒ…å¤±è´¥:', e);
            }
        }

        function renderDATM(datm) {
            const ctx = document.getElementById('datm-radar').getContext('2d');
            
            if (datmChart) datmChart.destroy();
            
            datmChart = new Chart(ctx, {
                type: 'radar',
                data: {
                    labels: ['Truth (çœŸ)', 'Goodness (å–„)', 'Beauty (ç¾)', 'Intelligence (çµ)'],
                    datasets: [{
                        label: 'DATM',
                        data: [datm?.truth || 50, datm?.goodness || 50, datm?.beauty || 50, datm?.intelligence || 50],
                        backgroundColor: 'rgba(99, 102, 241, 0.2)',
                        borderColor: 'rgba(99, 102, 241, 1)',
                        pointBackgroundColor: 'rgba(99, 102, 241, 1)'
                    }]
                },
                options: {
                    scales: { r: { min: 0, max: 100 } }
                }
            });
        }

        async function sendChat() {
            const input = document.getElementById('chat-input');
            const message = input.value.trim();
            if (!message || !currentAgentId) return;

            try {
                const resp = await fetch(`${API_BASE}/api/chat`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        agent_id: currentAgentId,
                        message: message
                    })
                });
                const data = await resp.json();

                // æ·»åŠ åˆ°å†å²
                const history = document.getElementById('chat-history');
                history.innerHTML += `
                    <div class="mb-2"><strong>ä½ :</strong> ${message}</div>
                    <div class="mb-2"><strong>${data.data.agent_name}:</strong> ${data.data.response}</div>
                `;
                history.scrollTop = history.scrollHeight;
                input.value = '';
            } catch (e) {
                console.error('å‘é€æ¶ˆæ¯å¤±è´¥:', e);
            }
        }

        async function createNewAgent() {
            const name = document.getElementById('new-agent-name').value;
            const domain = document.getElementById('new-agent-domain').value;
            const desc = document.getElementById('new-agent-desc').value;

            if (!name || !domain) return alert('è¯·å¡«å†™åç§°å’Œé¢†åŸŸ');

            try {
                await fetch(`${API_BASE}/api/agents`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        name: name,
                        domain: domain,
                        description: desc
                    })
                });
                refreshAll();
                showTab('agents');
            } catch (e) {
                console.error('åˆ›å»º Agent å¤±è´¥:', e);
            }
        }

        async function createAllAgents() {
            if (!confirm('ç¡®å®šè¦åˆ›å»º 100 ä½æ€æƒ³å®¶å—ï¼Ÿ')) return;

            try {
                const resp = await fetch(`${API_BASE}/api/tasks/create_agents_background`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ limit: 100 })
                });
                const data = await resp.json();
                alert(`ä»»åŠ¡å·²æäº¤: ${data.data.task_id}`);
                showTab('tasks');
            } catch (e) {
                console.error('åˆ›å»ºå¤±è´¥:', e);
            }
        }

        // ============ Discussion ç›¸å…³ ============

        async function loadDiscussions() {
            try {
                const resp = await fetch(`${API_BASE}/api/discussions`);
                const data = await resp.json();
                const topics = data.data || [];
                
                document.getElementById('discussion-count').textContent = topics.length;
                renderDiscussions(topics);
            } catch (e) {
                console.error('åŠ è½½è®¨è®ºå¤±è´¥:', e);
            }
        }

        function renderDiscussions(topics) {
            const list = document.getElementById('discussions-list');
            list.innerHTML = topics.map(topic => `
                <div class="bg-white rounded-lg shadow p-4 cursor-pointer hover:shadow-lg" onclick="showDiscussionDetail('${topic.id}')">
                    <div class="flex justify-between items-start">
                        <div>
                            <h3 class="font-bold">${topic.title}</h3>
                            <p class="text-sm text-gray-600 mt-1">${topic.description}</p>
                        </div>
                        <span class="text-xs bg-gray-100 px-2 py-1 rounded">${topic.phase}</span>
                    </div>
                    <div class="mt-3 flex gap-2 text-xs">
                        <span>ğŸ‘¥ ${topic.participants?.length || 0} äºº</span>
                        <span>ğŸ“ ${topic.category}</span>
                    </div>
                </div>
            `).join('');
        }

        async function showDiscussionDetail(topicId) {
            try {
                const resp = await fetch(`${API_BASE}/api/discussions/${topicId}/summary`);
                const data = await resp.json();
                const summary = data.data;

                currentDiscussionId = topicId;
                document.getElementById('modal-discussion-title').textContent = summary.topic.title;
                document.getElementById('modal-discussion-desc').textContent = summary.topic.description;
                document.getElementById('modal-discussion-phase').textContent = summary.current_phase;
                document.getElementById('modal-discussion-participants').textContent = `ğŸ‘¥ ${summary.statistics.agents ? Object.keys(summary.statistics.agents).length : 0} äºº`;

                document.getElementById('modal-discussion').classList.remove('hidden');
            } catch (e) {
                console.error('è·å–è®¨è®ºè¯¦æƒ…å¤±è´¥:', e);
            }
        }

        async function createDiscussion() {
            const title = document.getElementById('new-discussion-title').value;
            const desc = document.getElementById('new-discussion-desc').value;
            const category = document.getElementById('new-discussion-category').value;

            if (!title) return alert('è¯·å¡«å†™æ ‡é¢˜');

            try {
                await fetch(`${API_BASE}/api/discussions`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        title: title,
                        description: desc,
                        category: category
                    })
                });
                refreshAll();
                showTab('discussions');
            } catch (e) {
                console.error('åˆ›å»ºè®¨è®ºå¤±è´¥:', e);
            }
        }

        async function loadGreatDiscussions() {
            try {
                const resp = await fetch(`${API_BASE}/api/discussions/great_discussions`);
                const data = await resp.json();
                const discussions = data.data || [];

                // é€ä¸ªåˆ›å»º
                for (const d of discussions) {
                    await fetch(`${API_BASE}/api/discussions`, {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            title: d.title,
                            description: d.description,
                            category: d.category,
                            target_level: d.target_level,
                            keywords: d.keywords
                        })
                    });
                }
                refreshAll();
                alert(`å·²åˆ›å»º ${discussions.length} ä¸ªè®¨è®º`);
            } catch (e) {
                console.error('åŠ è½½å¤±è´¥:', e);
            }
        }

        async function startDiscussionFromModal() {
            if (!currentDiscussionId) return;

            // å…ˆåˆ†é…å‚ä¸è€…
            await fetch(`${API_BASE}/api/discussions/${currentDiscussionId}/assign`, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({})
            });

            // å¼€å§‹è®¨è®º
            await fetch(`${API_BASE}/api/discussions/${currentDiscussionId}/start`, {
                method: 'POST'
            });

            alert('è®¨è®ºå·²å¼€å§‹');
            loadDiscussions();
        }

        async function extractInsightsFromModal() {
            if (!currentDiscussionId) return;

            try {
                const resp = await fetch(`${API_BASE}/api/discussions/${currentDiscussionId}/extract_insights`, {
                    method: 'POST'
                });
                const data = await resp.json();
                const insights = data.data || [];

                const container = document.getElementById('modal-insights');
                container.classList.remove('hidden');
                document.getElementById('modal-insights-list').innerHTML = insights.map(i => `
                    <div class="bg-purple-50 p-3 rounded">
                        <span class="text-xs bg-purple-200 px-2 py-1 rounded">${i.insight_type}</span>
                        <p class="mt-1">${i.content}</p>
                    </div>
                `).join('');
            } catch (e) {
                console.error('æå–æ´è§å¤±è´¥:', e);
            }
        }

        async function addContribution() {
            const content = prompt('è¯·è¾“å…¥ä½ çš„è§‚ç‚¹:');
            if (!content) return;

            // è·å–ç¬¬ä¸€ä¸ª Agent
            try {
                const agentsResp = await fetch(`${API_BASE}/api/agents`);
                const agentsData = await agentsResp.json();
                const agents = agentsData.data.agents || {};
                const agentIds = Object.keys(agents);
                
                if (agentIds.length === 0) return alert('æ²¡æœ‰ Agent');

                await fetch(`${API_BASE}/api/discussions/${currentDiscussionId}/contribute`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        agent_id: agentIds[0],
                        content: content,
                        role: 'commentator',
                        round_num: 1
                    })
                });
                alert('å·²æ·»åŠ ');
            } catch (e) {
                console.error('æ·»åŠ å¤±è´¥:', e);
            }
        }

        // ============ Task ç›¸å…³ ============

        async function loadTasks() {
            try {
                const resp = await fetch(`${API_BASE}/api/tasks`);
                const data = await resp.json();
                const tasks = data.data?.tasks || [];
                
                document.getElementById('task-count').textContent = tasks.length;
                renderTasks(tasks);

                // è‡ªåŠ¨åˆ·æ–°è¿è¡Œä¸­çš„ä»»åŠ¡
                tasks.filter(t => t.status === 'running').forEach(t => {
                    setTimeout(loadTasks, 3000);
                });
            } catch (e) {
                console.error('åŠ è½½ä»»åŠ¡å¤±è´¥:', e);
            }
        }

        function renderTasks(tasks) {
            const list = document.getElementById('tasks-list');
            list.innerHTML = tasks.map(task => `
                <div class="flex items-center justify-between bg-gray-50 p-3 rounded">
                    <div>
                        <span class="font-bold">${task.task_type}</span>
                        <span class="text-xs text-gray-500 ml-2">${task.task_id}</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <div class="w-32 bg-gray-200 rounded-full h-2">
                            <div class="bg-indigo-500 h-2 rounded-full" style="width: ${task.progress}%"></div>
                        </div>
                        <span class="text-sm">${task.progress}%</span>
                        <span class="text-xs px-2 py-1 rounded ${getStatusColor(task.status)}">${task.status}</span>
                    </div>
                </div>
            `).join('');
        }

        function getStatusColor(status) {
            const colors = {
                'pending': 'bg-yellow-100',
                'running': 'bg-blue-100',
                'success': 'bg-green-100',
                'failure': 'bg-red-100',
                'cancelled': 'bg-gray-100'
            };
            return colors[status] || 'bg-gray-100';
        }

        // ============ å·¥å…·å‡½æ•° ============

        function getDomainEmoji(domain) {
            const emojis = {
                'physics': 'âš›ï¸',
                'chemistry': 'ğŸ§ª',
                'biology': 'ğŸ§¬',
                'mathematics': 'ğŸ”¢',
                'astronomy': 'ğŸŒŒ',
                'economics': 'ğŸ’°',
                'psychology': 'ğŸ§ ',
                'philosophy': 'ğŸ“œ',
                'art': 'ğŸ¨',
                'literature': 'ğŸ“š',
                'engineering': 'âš™ï¸',
                'medicine': 'ğŸ¥',
                'computer_science': 'ğŸ’»',
                'interdisciplinary': 'ğŸŒ'
            };
            return emojis[domain] || 'ğŸ“–';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.add('hidden');
        }

        function searchAgents() {
            const query = document.getElementById('search-agent').value.toLowerCase();
            document.querySelectorAll('.agent-card').forEach(card => {
                const name = card.querySelector('h3').textContent.toLowerCase();
                card.style.display = name.includes(query) ? 'block' : 'none';
            });
        }

        function filterAgents() {
            const domain = document.getElementById('filter-domain').value;
            document.querySelectorAll('.agent-card').forEach(card => {
                if (!domain) {
                    card.style.display = 'block';
                } else {
                    const cardDomain = card.querySelector('.bg-gray-100').textContent;
                    card.style.display = cardDomain === domain ? 'block' : 'none';
                }
            });
        }
    </script>
</body>
</html>
