# SuiLight 知识胶囊系统设计

## 一、核心概念

### 什么是知识胶囊？

```
知识胶囊 = 知识沙龙的最终产出物

与普通讨论记录的区别:
├── 普通记录: 讨论过程的完整记录
└── 知识胶囊: 讨论精华的高度浓缩
    ├── 核心洞见 (insight)
    ├── 支撑证据 (evidence)
    ├── 行动建议 (action_items)
    └── 开放问题 (questions)
```

### 设计原则

1. **成果导向** - 讨论过程不重要，关键是产出胶囊
2. **质量评价** - 基于 DATM 维度和置信度
3. **可沉淀** - 胶囊可以存储、检索、分享
4. **可进化** - 胶囊可以迭代更新

---

## 二、知识胶囊结构

```python
@dataclass
class KnowledgeCapsule:
    # 基本信息
    id: str                    # 唯一标识
    topic_id: str              # 来源讨论
    title: str                 # 胶囊标题
    summary: str               # 简短摘要 (100字)
    
    # 核心内容
    insight: str               # 核心洞见 (最关键!)
    evidence: List[str]        # 支撑证据
    action_items: List[str]    # 行动建议
    questions: List[str]       # 开放问题
    
    # 评价
    dimensions: DATM           # 四维评分
    confidence: float          # 置信度 (0-1)
    
    # 元数据
    source_agents: List[str]   # 参与专家
    keywords: List[str]        # 关键词
    category: str              # 分类
```

---

## 三、评价体系

### 质量分数公式

```
质量分数 = DATM综合分 × 置信度

DATM综合分 = (Truth + Goodness + Beauty + Intelligence) / 4
置信度 = 参与度 × 0.6 + 维度分 × 0.4
```

### 等级划分

| 等级 | 分数范围 | 说明 |
|------|----------|------|
| **A** | ≥80 | 优秀，可直接发布 |
| **B** | 60-79 | 良好，稍作修改 |
| **C** | 40-59 | 一般，需要补充 |
| **D** | <40 | 待改进，不发布 |

### 改进建议

系统会根据维度缺失自动生成建议：

```
如果 Truth < 60: "建议增加科学性支撑，增加数据和证据"
如果 Goodness < 60: "建议增加价值判断和伦理考量"
如果 Beauty < 60: "建议提升表达的感染力和美学价值"
如果 Intelligence < 60: "建议增加创新性思考和前瞻性观点"
如果 Confidence < 0.6: "建议邀请更多专家参与讨论"
```

---

## 四、生成流程

```
讨论进行中
    ↓
收集所有贡献 (Agent观点、证据、结论)
    ↓
提取核心洞见 (Insight Extraction)
    ↓
提取支撑证据 (Evidence Extraction)
    ↓
提取行动建议 (Action Extraction)
    ↓
计算维度评分 (DATM Calculation)
    ↓
生成知识胶囊 (Capsule Generation)
    ↓
质量评价 (Quality Evaluation)
    ↓
存储/发布 (Storage/Publishing)
```

---

## 五、使用示例

### 1. 生成胶囊

```bash
# 从讨论生成胶囊
curl -X POST "http://localhost:8000/api/discussions/{topic_id}/generate_capsule"

# 返回
{
  "success": true": {
    ",
  "datacapsule": {
      "id": "abc123",
      "title": "关于「XX问题」的知识胶囊",
      "insight": "核心洞见...",
      "evidence": ["证据1", "证据2"],
      "action_items": ["建议1", "建议2"],
      "dimensions": {
        "truth": 75,
        "goodness": 60,
        "beauty": 55,
        "intelligence": 80
      },
      "confidence": 0.72,
      "quality_score": 67.5
    },
    "evaluation": {
      "grade": "B",
      "level": "良好",
      "is_publishable": true,
      "suggestions": ["建议增加伦理考量"]
    }
  }
}
```

### 2. 评价胶囊

```python
from src.knowledge.capsule import CapsuleEvaluator

evaluator = CapsuleEvaluator()
result = evaluator.evaluate(capsule)

print(f"等级: {result['grade']}")
print(f"质量分数: {result['quality_score']}")
print(f"可发布: {result['is_publishable']}")
```

---

## 六、与其他系统的关系

```
┌─────────────────────────────────────────────────────────┐
│                    知识沙龙系统                          │
├─────────────────────────────────────────────────────────┤
│                                                         │
│  ┌──────────┐    ┌──────────┐    ┌──────────┐          │
│  │ Agent    │───▶│ 讨论系统 │───▶│ 胶囊系统 │          │
│  │ 系统     │    │          │    │          │          │
│  └──────────┘    └──────────┘    └──────────┘          │
│       │               │               │                 │
│       │               │               ▼                 │
│       │               │         ┌──────────┐          │
│       │               │         │ 存储系统 │          │
│       │               │         └──────────┘          │
│       │               │               │                 │
│       ▼               ▼               ▼                 │
│  ┌──────────────────────────────────────────────┐     │
│  │              评价与沉淀                        │     │
│  │  - 胶囊质量评价                               │     │
│  │  - 知识图谱构建                               │     │
│  │  - 最佳实践沉淀                               │     │
│  └──────────────────────────────────────────────┘     │
│                                                         │
└─────────────────────────────────────────────────────────┘
```

---

## 七、下一步开发

### 短期 (1-2周)

| 任务 | 优先级 | 输出 |
|------|--------|------|
| 胶囊存储 | P0 | 存储到 SQLite |
| 胶囊检索 | P0 | 按标签/维度检索 |
| 胶囊展示 UI | P1 | Web UI 显示胶囊 |
| 胶囊模板 | P2 | 预设胶囊模板 |

### 中期 (1个月)

| 任务 | 优先级 | 输出 |
|------|--------|------|
| 胶囊演进 | P1 | 胶囊版本管理 |
| 胶囊协作 | P1 | 多用户编辑 |
| 胶囊分享 | P2 | 分享链接 |
| 胶囊市场 | P2 | 胶囊分享平台 |

---

## 八、衡量指标

### 核心指标

| 指标 | 说明 | 目标 |
|------|------|------|
| **胶囊产出率** | 每讨论产出胶囊数 | ≥80% |
| **胶囊质量** | 质量分数均值 | ≥60 |
| **胶囊发布率** | 发布/产出比 | ≥50% |
| **胶囊复用率** | 被引用次数 | 待定 |

### 运营指标

| 指标 | 说明 | 目标 |
|------|------|------|
| **周产出** | 每周胶囊数 | ≥10 |
| **A级占比** | 优秀胶囊占比 | ≥20% |
| **用户满意度** | 胶囊有用性评分 | ≥4.0/5 |

---

## 九、总结

### 知识胶囊 = 知识沙龙的"产品"

```
传统讨论: 聊完就散
知识沙龙: 聊完产出胶囊
         ↓
    可存储、可检索、可复用
         ↓
    沉淀为组织知识资产
```

### 价值

| 价值 | 说明 |
|------|------|
| **可量化** | 胶囊数量 = 产出 |
| **可评价** | 质量分数 = 价值 |
| **可沉淀** | 胶囊库 = 知识库 |
| **可复用** | 新讨论引用旧胶囊 |

---

**核心观点**: 讨论过程不重要，重要的是产出知识胶囊！
